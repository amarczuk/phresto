<div id='files' class='small 12-columns'>
<ul class="tabs">
<li class="tab-title active"><a class='showOutput'>{? LAN_CODE_OUTPUT ?}</a></li>
{? repeat($codes) ?}
<li class="tab-title"><a class='showCode' data-name='{? $codes[name] ?}'>{? $codes[name] ?}</a></li>
{? /repeat ?}
</ul>
</div>

<div id='outputFrame'>
	<iframe id='oiframe' src="/code/exec/{? $projectId ?}/{? $run ?}?pf_ind=1"></iframe>
</div>

<div id='codeSrc'>
	<div id='codeEdit'></div>
</div>

<div id='foot' class='small 12-columns clearfix'>
	<div class="left">
		<a href="/" target='_new'>Powered by PHPfy</a>
	</div>
	<div class='right'>
		<a href="/code/{? $projectId ?}/{? $id ?}" target='_new'>open sandbox</a>
		{? if($clone=yes) ?} | <a href="/clone/{? $projectId ?}/{? $id ?}" target='_new'>clone & play</a>{? /if ?}
	</div>
</div>

<script>
	var phpfy = phpfy || {};

	phpfy.embed = new function() {
		this.codes = {? $codesjson ?};
		this.editor = {};

		this.resize = function() {
	    	var dh = $( window ).height() - $( '#files' ).height() - $( '#foot' ).outerHeight();
			$( '#codeEdit' ).css( 'height', dh + 'px' );
			$( '#outputFrame' ).css( 'height', dh + 'px' );
		}

		this.resize();
		this.editor = ace.edit( 'codeEdit' );
		this.editor.setTheme("ace/theme/monokai");
    	this.editor.$blockScrolling = Infinity;
    	this.editor.setReadOnly( true );


		this.showOutput = function() {
			$( '#codeSrc' ).hide();
			$( '#outputFrame' ).show();
		}

		this.showCode = function( obj ) {
			var code = this.codes[ $( obj ).data( 'name' ) ];
        	this.editor.getSession().setMode("ace/mode/" + code.type );
        	this.editor.getSession().setValue( code.code );
        	$( '#outputFrame' ).hide();
			$( '#codeSrc' ).show();
		}
	}

	$( window ).on( 'resize.embed', function() { phpfy.embed.resize() } );
	$( document ).on( 'click.embed.code', '.showCode', function() { phpfy.embed.showCode( this ) } );
	$( document ).on( 'click.embed', '.showOutput', function() { phpfy.embed.showOutput() } );
	$( document ).on( 'click.embed.tab', '.tab-title', function() { $( '.tab-title' ).removeClass( 'active' ); $( this ).addClass( 'active' ); } );

	$( function() {
		$( $( '.showCode' )[0] ).click();
	} );
</script>

<style type="text/css">
body {
	font-family: 'Khand', arial, sans-serif;
    color: #fff;
    background-color: #2F3129;
    line-height: 2;
    letter-spacing: 0.09em;
}

h1, h2, h3, h4, h5, h6,
.top-bar-section ul li > a,
.label,
button, .button,
select,
.tabs .tab-title > a {
    font-family: 'Khand', arial, sans-serif;
}

.tabs dd > a, .tabs .tab-title > a {
	background-color: #2F3129;
	color: #fff;
}

.tabs .tab-title > a:hover {
	color: #666;
}

.tabs .tab-title {
	line-height: 1;
}

#oiframe {
	width: 100%; 
	height: 100%; 
	border: 0;
	border-top: 1px solid #bbb; 
	border-bottom: 1px solid #bbb; 
	margin: 0; 
	padding: 0;
	background: #fff;
}

#codeSrc {
	letter-spacing: normal;
	display: none;
	position: relative;
	margin: 0;
	padding: 0;
	width: 100%;
}
#codeEdit {
	margin: 0;
	padding: 0;
	min-height: 100px;
}

#foot {
	padding: 5px 15px 0 15px;
}

a {
	color: #fff;
}
</style>