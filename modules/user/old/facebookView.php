<?phpclass facebookView extends View {	protected $module = 'user';	protected function _prepare() {		$this->setModule();			global $User;		global $Config;		try {			$conf = $Config->getConfig( 'social' );			$fb = new FBApi( $conf['fb']['key'], $conf['fb']['secret'] );			$User->socialLogin( $fb->getUserDetails() );						$unlock = '';			if ( !empty( $_SESSION['login_from'] ) ) {				$project = new Project( null, $_SESSION['login_from'] );				if ( $project->isEditable() ) $unlock = 'true';			}			$Config->Templ->AddScript( 'inline_js', 'opener.phpfy.social.success(' . $unlock . '); opener.focus(); window.close();' );		} catch( Exception $e ) {			$Config->Templ->AddScript( 'inline_js', 'opener.phpfy.social.error("' . str_replace( ['"', "\n","\r"], "'", $e->getMessage() ) . '"); opener.focus(); window.close();' );		}    }};